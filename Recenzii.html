<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Recenzii | MC Eternal Petals</title>

    <!-- Google Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,600;0,700;1,400;1,600&family=Montserrat:wght@100;200;300;400;500;600&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    
    <!-- Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            magenta: "#E467DA",
                            ice: "#b8f4ff",
                            dark: "#130925",
                            blue: "#718ce5",
                            softpink: "#FAD0E6"
                        },
                    },
                    fontFamily: {
                        serif: ['"Cormorant Garamond"', "serif"],
                        sans: ['"Montserrat"', "sans-serif"],
                    },
                },
            },
        };
    </script>

    <style>
        body { background-color: #130925; color: #FAD0E6; font-family: 'Montserrat', sans-serif; overflow-x: hidden; }
        .glow-soft { position: absolute; width: 600px; height: 600px; filter: blur(150px); pointer-events: none; z-index: 0; opacity: 0.15; }
        
        /* Review Card Style */
        .indigo-frame {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(113, 140, 229, 0.2);
            transition: all 0.4s ease;
        }
        .indigo-frame:hover { border-color: #b8f4ff; transform: translateY(-5px); }
        
        /* Star Selector */
        .star-rating i { cursor: pointer; transition: 0.2s; color: #333; }
        .star-rating i.active { color: #E467DA; text-shadow: 0 0 10px rgba(228,103,218,0.5); }
        
        .progress-bar { height: 6px; background: rgba(255,255,255,0.05); border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: #E467DA; transition: width 0.8s ease; }

        input, textarea { background: rgba(255,255,255,0.05); border: 1px solid rgba(113,140,229,0.2); color: white; outline: none; transition: 0.3s; }
        input:focus, textarea:focus { border-color: #E467DA; }
    </style>
</head>
<body>

<!-- NAVIGATION (Simplified for Reviews) -->
<nav class="fixed w-full z-50 px-6 py-6 flex items-center justify-between bg-brand-dark/80 backdrop-blur-md border-b border-brand-blue/10">
    <a href="index.html" class="w-32"><img src="https://firebasestorage.googleapis.com/v0/b/ksda-7546f.firebasestorage.app/o/HM%20MC%2F58e030c9-f51d-4b5f-abb2-8b88ea0f9507.png?alt=media&token=abbedc81-126b-44a2-b492-66eac45a447d" alt="Logo"></a>
    <div class="hidden md:flex space-x-8 text-[11px] uppercase tracking-widest">
        <a href="index.html" class="hover:text-brand-ice">Acasă</a>
        <a href="index.html#collection" class="hover:text-brand-ice">Colecție</a>
    </div>
    <button onclick="handleAccountClick()" class="login-trigger-text border border-brand-magenta/40 px-6 py-2 rounded-full text-[9px] font-bold tracking-widest uppercase text-brand-ice hover:bg-brand-magenta transition-all">Log In</button>
</nav>

<main class="pt-32 pb-20 px-6 max-w-5xl mx-auto relative">
    <div class="glow-soft" style="background: #9E4FE8; top: 0; left: 50%; transform: translateX(-50%);"></div>

    <!-- Header Section -->
    <div class="text-center mb-16 relative z-10" data-reveal="up">
        <span class="text-brand-magenta text-[10px] uppercase tracking-[0.6em] mb-4 block font-bold">Feedback Clienți</span>
        <h1 class="text-5xl md:text-7xl font-serif italic mb-6">Recenzii <br/> <span class="text-white/20 not-italic">Artistry</span></h1>
    </div>

    <!-- Summary Stats -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-16 items-center indigo-frame p-8 rounded-2xl relative z-10">
        <div class="text-center md:border-r border-white/10">
            <div class="text-6xl font-serif text-brand-ice mb-2" id="avgScore">0.0</div>
            <div class="text-brand-magenta text-lg mb-2" id="avgStars">☆☆☆☆☆</div>
            <div class="text-[10px] uppercase tracking-widest opacity-50"><span id="totalCount">0</span> Recenzii</div>
        </div>
        <div class="md:col-span-2 space-y-3">
            <!-- Bars -->
            <div class="flex items-center gap-4 text-[10px] tracking-widest">
                <span class="w-12">5 Stele</span>
                <div class="progress-bar flex-1"><div id="bar5" class="progress-fill" style="width: 0%"></div></div>
                <span id="perc5" class="w-8">0%</span>
            </div>
            <div class="flex items-center gap-4 text-[10px] tracking-widest">
                <span class="w-12">4 Stele</span>
                <div class="progress-bar flex-1"><div id="bar4" class="progress-fill" style="width: 0%"></div></div>
                <span id="perc4" class="w-8">0%</span>
            </div>
            <div class="flex items-center gap-4 text-[10px] tracking-widest">
                <span class="w-12">3 Stele</span>
                <div class="progress-bar flex-1"><div id="bar3" class="progress-fill" style="width: 0%"></div></div>
                <span id="perc3" class="w-8">0%</span>
            </div>
            <div class="flex items-center gap-4 text-[10px] tracking-widest">
                <span class="w-12">2 Stele</span>
                <div class="progress-bar flex-1"><div id="bar2" class="progress-fill" style="width: 0%"></div></div>
                <span id="perc2" class="w-8">0%</span>
            </div>
            <div class="flex items-center gap-4 text-[10px] tracking-widest">
                <span class="w-12">1 Stea</span>
                <div class="progress-bar flex-1"><div id="bar1" class="progress-fill" style="width: 0%"></div></div>
                <span id="perc1" class="w-8">0%</span>
            </div>
        </div>
    </div>

    <!-- Review Feed -->
    <div id="reviewsList" class="space-y-6 mb-20 relative z-10">
        <!-- Reviews injected here -->
        <div class="text-center py-10 opacity-30 italic">Se încarcă recenziile...</div>
    </div>

    <!-- Input Area (Only for logged in users who haven't posted) -->
    <div id="writeReviewSection" class="hidden indigo-frame p-8 md:p-12 rounded-2xl relative z-10 border-t-2 border-brand-magenta">
        <h2 class="text-3xl font-serif italic mb-8 text-center text-brand-ice">Spune-ne părerea ta</h2>
        
        <div class="flex justify-center gap-4 mb-8 star-rating text-2xl" id="starSelector">
            <i class="fas fa-star" data-val="1"></i>
            <i class="fas fa-star" data-val="2"></i>
            <i class="fas fa-star" data-val="3"></i>
            <i class="fas fa-star" data-val="4"></i>
            <i class="fas fa-star" data-val="5"></i>
        </div>

        <textarea id="revText" class="w-full p-6 rounded-lg mb-6 h-32 resize-none" placeholder="Cum a fost experiența ta cu florile noastre?"></textarea>
        
        <div class="flex justify-center">
            <button id="submitReview" class="bg-brand-magenta text-white px-12 py-4 rounded-full font-bold uppercase tracking-widest text-xs hover:bg-brand-blue transition-all">Trimite Recenzia</button>
        </div>
    </div>

    <div id="alreadyPostedMsg" class="hidden text-center p-8 indigo-frame rounded-2xl italic opacity-60">
        Vă mulțumim! Ați lăsat deja o recenzie pentru MC Artistry.
    </div>

    <div id="loginToPostMsg" class="text-center p-8 indigo-frame rounded-2xl">
        <p class="mb-4 opacity-70">Trebuie să fii logat pentru a lăsa o recenzie.</p>
        <button onclick="window.toggleAuthModal()" class="text-brand-magenta font-bold uppercase tracking-widest text-[10px] border-b border-brand-magenta/30 pb-1">Loghează-te acum</button>
    </div>
</main>

<!-- FOOTER (Copied from main) -->
<footer class="bg-[#0D071A] py-12 text-center border-t border-brand-blue/10">
    <p class="text-[9px] uppercase tracking-[0.4em] text-brand-blue/40">&copy; 2026 MC HANDMADE MARRY</p>
</footer>

<!-- MODALS (Include AuthModal and UserModal from previous steps) -->
<!-- Copiază aici codul pentru #authModal și #userModal din fișierul anterior -->

<script type="module">
    // --- FIREBASE LOGIC ---
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
    import { getFirestore, collection, doc, setDoc, getDoc, getDocs, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBiZY4tIZGstiZhw_jiuhvNZ8ZtGCjQb5w",
        authDomain: "handmade-marry.firebaseapp.com",
        projectId: "handmade-marry",
        storageBucket: "handmade-marry.firebasestorage.app",
        messagingSenderId: "30193148874",
        appId: "1:30193148874:web:04c1b35f3e54ed43ee2533"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let selectedRating = 0;
    let hasPosted = false;

    // --- UI STARS ---
    document.querySelectorAll('#starSelector i').forEach(star => {
        star.onclick = () => {
            selectedRating = parseInt(star.getAttribute('data-val'));
            document.querySelectorAll('#starSelector i').forEach((s, idx) => {
                s.classList.toggle('active', idx < selectedRating);
            });
        };
    });

    // --- FETCH REVIEWS & STATS ---
    async function loadReviews() {
        const q = query(collection(db, "reviews"), orderBy("createdAt", "desc"));
        const snap = await getDocs(q);
        const list = document.getElementById('reviewsList');
        list.innerHTML = "";

        let stats = { total: 0, sum: 0, counts: {1:0, 2:0, 3:0, 4:0, 5:0} };

        snap.forEach(docSnap => {
            const data = docSnap.data();
            stats.total++;
            stats.sum += data.rating;
            stats.counts[data.rating]++;

            const card = document.createElement('div');
            card.className = "indigo-frame p-6 rounded-xl flex flex-col md:flex-row gap-6 items-start";
            card.innerHTML = `
                <img src="${data.photo || 'https://i.pravatar.cc/150'}" class="w-12 h-12 rounded-full border border-brand-magenta/30">
                <div class="flex-1">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="font-serif italic text-xl text-brand-ice">${data.name}</h4>
                        <span class="text-brand-magenta">${'★'.repeat(data.rating)}${'☆'.repeat(5-data.rating)}</span>
                    </div>
                    <p class="text-sm opacity-80 leading-relaxed">${data.text}</p>
                    <div class="text-[8px] uppercase tracking-widest opacity-30 mt-4">${data.createdAt?.toDate().toLocaleDateString() || 'Recent'}</div>
                </div>
            `;
            list.appendChild(card);
        });

        // Update Stats UI
        if(stats.total > 0) {
            const avg = (stats.sum / stats.total).toFixed(1);
            document.getElementById('avgScore').innerText = avg;
            document.getElementById('avgStars').innerText = '★'.repeat(Math.round(avg)) + '☆'.repeat(5-Math.round(avg));
            document.getElementById('totalCount').innerText = stats.total;
            
            for(let i=1; i<=5; i++) {
                const p = ((stats.counts[i] / stats.total) * 100).toFixed(0);
                document.getElementById(`bar${i}`).style.width = p + "%";
                document.getElementById(`perc${i}`).innerText = p + "%";
            }
        }
    }

    // --- POST REVIEW ---
    document.getElementById('submitReview').onclick = async () => {
        if(selectedRating === 0) return alert("Alegeți un număr de stele.");
        const text = document.getElementById('revText').value.trim();
        if(text.length < 5) return alert("Vă rugăm scrieți o recenzie mai detaliată.");

        const user = auth.currentUser;
        await setDoc(doc(db, "reviews", user.uid), {
            uid: user.uid,
            name: user.displayName || "Client MC",
            photo: user.photoURL,
            rating: selectedRating,
            text: text,
            createdAt: serverTimestamp()
        });

        location.reload();
    };

    // --- AUTH OBSERVER ---
    onAuthStateChanged(auth, async (user) => {
        window.currentUser = user;
        const writeSec = document.getElementById('writeReviewSection');
        const loginMsg = document.getElementById('loginToPostMsg');
        const postMsg = document.getElementById('alreadyPostedMsg');

        if(user) {
            loginMsg.classList.add('hidden');
            const docSnap = await getDoc(doc(db, "reviews", user.uid));
            if(docSnap.exists()) {
                postMsg.classList.remove('hidden');
                writeSec.classList.add('hidden');
            } else {
                writeSec.classList.remove('hidden');
            }
        } else {
            loginMsg.classList.remove('hidden');
            writeSec.classList.add('hidden');
        }
        loadReviews();
    });
</script>

<!-- REUTILIZEAZĂ FUNCȚIILE UI (toggleAuthModal, etc) DIN INDEX.HTML -->
</body>
</html>
